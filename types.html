<!-- $Id: types.html,v 1baa89ad78ee 2003/01/13 20:37:43 simon $ -->
<head>
<title>ColdFrame: Types</title>
</head>
<body bgcolor="white">
<h1>ColdFrame: Types</h1>

<h2>Motivation</h2>

<p>Clearly a class corresponds, in a programming language sense, to a
type. In Ada, you'll see statements like
<pre>
   type My_Class is ...
</pre>

<p>The distinction that ColdFrame makes between <i>type</i> and
<i>class</i> is that classes have instances, each instance being
distinct from any other instance, while types merely have values, and
you can have many different identical values of the same type.


<h2>Modelling</h2>

<p>The following fundamental types are implicitly declared:
<ul>

<li><i>Date</i>, <i>Time</i>

<li><i>Real</i>

<li><i>Text</i>

</ul>

<p>As well as this, other implicitly-declared types are available:

<ul>

<li><i>Autonumber</i> - used for automatically-generated instance
identifiers

<li><i>Counterpart</i> - used for references to instances in other
domains (but see the <i>[[counterpart]]</i> annotation below).

<li><i>Timer</i> - used (mainly) for timeouts in state machines

<li>Any simple name (for example, <i>Boolean</i>, <i>Integer</i>)

<li>Any class in the domain

</ul>

<p>Other types are modelled in classes stereotyped
<em>&#171;type&#187;</em>.

<h3>Type details</h3>

<p>Extra information comes in
<i>annotations</i>, placed in the documentation section (in Rose the
bottom left pane), in sections delimited by <tt>[[&nbsp;]]</tt>; for
example,
<tt>[[&nbsp;discriminated&nbsp;]]</tt>.

<p>At some future time, this scheme may be converted to one using
tagged values.

<p>The annotations supported for <em>&#171;type&#187;</em>s are:

<ul>

<li><tt>callback : <i>max</i></tt> specifies that <a
href="coldframe-callback.pdf">callback support code</a> is to be
generated. The idea here is that a (lower-level) Domain may need to
support up to <tt><i>max</i></tt> Observers from higher-level Domains,
and the higher-level Domains can register to be notified when
something has changed in the lower-level Domain.

<li><tt>counterpart</tt> is used for references to instances in other
domains.

<li><tt>discriminated</tt> (only relevant if the type is a record
type, ie has attributes) causes the generation of discriminated
records; the discriminant is an enumeration type with literals formed
from the attribute names with <tt>_T</tt> appended.

<li><tt>enumeration : <i>literal-1</i>, <i>literal-2</i>, ...</tt>

<li><tt>extends : <i>external-type</i></tt> specifies that the
given type extends (inherits) the specified  external reference.

<li><tt>hash : <i>style</i></tt> specifies how a type (presumably
<tt><i>imported</i></tt> or <tt><i>renames</i></tt>) is to be
hashed. Currently the only supported <i>style</i> is
<tt>discrete</tt>, which will work for imported enumerations or
integer ranges but not for private or access types.

<li><tt>imported : <i>external-reference</i></tt> specifies that the
given type is to be found at the specified external reference.

<li><tt>renames : <i>external-type</i></tt> specifies that the given
type is a renaming of the specified external reference.

<li><tt>real : digits <i>num-digits</i>, lower <i>low-bound</i>,
upper <i>upper-bound</i></tt>

<li><tt>string : max <i>max-length</i></tt>

</ul>

<p>Syntactically, you can specify multiple annotations using semicolon
separators. This probably only makes sense for adding callbacks:
<pre>
   [[ real : lower -100.0, upper 100.0; callback : 1 ]]
</pre>

<h3>Operations</h3>

<p>Types can have operations.

<h2>Translation</h2>

<p>Implicity-declared types are translated as follows:

<dl>

<dt><i>Date</i>, <i>Time</i><dd><tt>ColdFrame.Calendar.Time</tt>

<dt><i>Real</i><dd><tt>Float</tt>

<dt><i>Text</i><dd><tt>Ada.Strings.Unbounded.Unbounded_String</tt>

<dt><i>Autonumber</i><dd><tt>Long_Long_Integer</tt> (64 bits)

<dt><i>Counterpart</i><dd><tt>ColdFrame.Instances.Handle</tt>

<dt><i>Timer</i><dd><tt>ColdFrame.Project.Events.Timer</tt>

<dt>Any simple name (for example, <i>Boolean</i>,
<i>Integer</i>)<dd>itself (after replacing spaces by underscores and
case adjustment)

<dt>The current class<dd><tt>Handle</tt>

<dt>Any other class in the domain<dd><tt>ColdFrame.Instances.Handle</tt>

</dl>

<p>New types are declared in the domain package. Where appropriate,
supporting code is generated as a child unit of the domain package.

<p>Operations of types are generated in the domain package. They have
no <tt>This</tt> parameter.

<h3>Annotations</h3>
 
<ul>

<li><tt>callback : <i>max</i></tt>

<p>For a type <tt>Typ</tt>, with <tt>[[ callback : 4 ]]</tt>, the
generated code is an instantiation of <tt>ColdFrame.Callbacks</tt>:
<pre>
   with ColdFrame.Callbacks;
   package <i>Domain</i>.<i>Typ</i>_Callback
   is new ColdFrame.Callbacks
     (T => <i>Domain</i>.<i>Typ</i>,
      Maximum_Size => 4);
</pre>

<li><tt>counterpart</tt>

<p>For a type named <tt>T_Handle</tt>, gives
<pre>
   with ColdFrame.Instances;
   ..
   subtype T_Handle is ColdFrame.Instances.Handle;
</pre>

<li><tt>discriminated</tt>

<p>Given a model fragment as in the picture

<p><a name="discriminated-record-pic"><img src="discriminated-record.png"></a>

<p>where <i>Alert Level</i> is an enumeration, <i>Information</i> is a
lengthed string, and <i>Message</i> is
<tt>[[&nbsp;discriminated&nbsp;]]</tt>, ColdFrame generates
<pre>
   type Message_Discriminant is
     (Info_T,
      Level_T);
   type Message
     (Discriminant : Message_Discriminant
      := Message_Discriminant'First)
   is record
      case Discriminant is
         when Info_T =>
            Info : Information;
         when Level_T =>
            Level : Alert_Level;
      end case;
   end record;
</pre>

<li><tt>enumeration : <i>literal-1</i>, <i>literal-2</i>, ...</tt>:
gives, for example (see <a href="#discriminated-record-pic">above</a>),
<pre>
   type Alert_Level is
     (Low,
      Medium,
      High);
</pre>

<li><tt>extends : <i>external-type</i></tt>: for a type named
<tt>Derived</tt>, extending <tt><i>Other_Domain</i>.Base</tt>, gives
<pre>
   with <i>Other_Domain</i>;
   ..
   type Base is new <i>Other_Domain</i>.Base with record
      ..
   end record;
</pre>

<li><tt>imported : <i>external-reference</i></tt>: for a type named
<tt>T</tt> gives
<pre>
   with <i>external-reference</i>;
   ..
   subtype T is <i>external-reference</i>.T;
   use type T;
</pre>
(clearly <tt><i>external-reference</i></tt> needs to correspond to a
with-able package name).

<p>

<li><tt>renames : <i>external-type</i></tt>: for a type named
<tt>T</tt>, renaming <tt>Ada.Real_Time.Time</tt>, gives
<pre>
   with Ada.Real_Time;
   ..
   subtype T is Ada.Real_Time.Time;
   use type T;
</pre>

<li><tt>integer : lower <i>low-bound</i>, upper
<i>upper-bound</i></tt>: gives
<pre>
   type T is range <i>low-bound</i> .. <i>upper-bound</i>;
</pre>

<li><tt>real : digits <i>num-digits</i>, lower <i>low-bound</i>, upper
<i>upper-bound</i></tt>: gives a floating-point type. If
<i>num-digits</i> is omitted or not more than 6, it's a subtype of
<tt>Float</tt>, otherwise it's a subtype of <tt>Long_Float</tt>. If
the lower and upper bounds are given, they translate to a constraint.

<p><tt>[[ real : digits 5 ]]</tt> gives
<pre>
   subtype T is Float;
</pre>

<p><tt>[[ real : digits 9, lower 0.0, upper 1_000_000.0 ]]</tt> gives
<pre>
   subtype T is Long_Float range 0.0 .. 1_000_000.0;
</pre>

<li><tt>string : max <i>max-length</i></tt> gives an instantiation of
<tt>Ada.Strings.Bounded</tt>'s <tt>Generic_Bounded_Length</tt>; for
example (see <a href="#discriminated-record-pic">above</a>),
<pre>
   with Ada.Strings.Bounded; use Ada.Strings.Bounded;
   package <i>Domain</i> is

      package Information_Package is
	new Generic_Bounded_Length (Max => 79);
      subtype Information is Information_Package.Bounded_String;
</pre>

<p>and a library-level hash function
<pre>
   with ColdFrame.Hash.Strings.Bounded;
   function <i>Domain</i>.Information_Hash
   is new ColdFrame.Hash.Strings.Bounded (Information_Package);
</pre>

</ul>

<h2>Use</h2>

<h3>Type extension</h3>

<p>The <i>extends</i> annotation is intended to support the use of
external packages which require type extension (for example, to take
data records). It is not meant to provide generalized support for type
extension. If you <i>really</i> want to use Ada tagged types, or
indeed other features of Ada that ColdFrame doesn't use, then either
you should be translating your UML models by hand or your model needs
rethinking; check out <a
href="resources.html#build-object-models">Leon Starr's book</a>.

<p><hr>
<i>
<address>
<a href="mailto:simon@pushface.org">Simon Wright</a>
</address>
<script>
document.write("Last update: ");
document.write(document.lastModified);
</script>
</i></body>
</html>
