<!-- $Id: event-translation.html,v 19d21851b72c 2003/03/29 18:11:33 simon $ -->
<html>
<head>
<title>ColdFrame: Event translation</title>
</head>
<body bgcolor="white">
<h1>ColdFrame: Event translation</h1>

<h2>Events</h2>

<p>Each event is mapped to a distinct type, derived from
<tt>ColdFrame.Project.Events.Event_Base</tt>, in the package for the
class to which the event is directed. Instance events are derived from
<tt>Instance_Event_Base</tt>, a child of <tt>Event_Base</tt> which is
constrained by an access to the instance to which the event is
directed.

<p>For a class event, this results in
<pre>
   type Wait
   is new ColdFrame.Project.Events.Event_Base with null record;
</pre>

<p>and for an instance event, in
<pre>
   type Done (For_The_Instance : access Instance)
   is new ColdFrame.Project.Events.Instance_Event_Base (For_The_Instance)
   with null record;
</pre>

<p>If the event has a payload, it translates to an extension component
of the type concerned, named <tt>Payload</tt>:
<pre>
   type Info
   is new ColdFrame.Project.Events.Event_Base with record
      Payload : Message;
   end record;
</pre>

<h2>States</h2>

<p>The states in the state model are translated as a private
enumeration type, <tt>State_Machine_State_T</tt>. The initial state
(by default <tt>Initial</tt>) is the first literal.

<p><a href="event-modelling.html#example-model">In the example</a>,
the type would be
<pre>
   type State_Machine_State_T is
     (Initial,
      Off,
      On,
      Resetting);
</pre>

<p>The instance state is represented by a created instance variable
<pre>
   State_Machine_State : State_Machine_State_T := Initial;
</pre>

<p>This is not intended to be made directly visible outside the
class. Instead, it's expected that you'll test it within operations
and return an appropriate result:
<pre>
   function <a name="is_on">Is_On</a> (This : Handle) return Boolean is
   begin
      return This.State_Machine_State = On;
   end Is_On;
</pre>

<h2>Transitions</h2>

<p>When an event is dispatched to a state machine, there are three
possible outcomes, depending on what the state model says about the
event occuring in the current state:

<ul>

<li>If the transition is marked <em>&#171;ignore&#187;</em>, the
event is thrown away.

<li>If the transition isn't in the model, the exception
<tt>ColdFrame.Exceptions.Cant_Happen</tt> is raised.

<li>Otherwise, it's a legal transition.

<ol>

<li>The instance variable <tt>Old_State_Machine_State</tt> is set to the
current state,

<li>the instance variable <tt>State_Machine_State</tt> is set to the
target state,

<li>the entry actions are executed in order.

</ol>

</ul>

<p>It is legal to use the instance <tt>Delete</tt> operation as an
entry action (ColdFrame doesn't check that it's in a <i>final</i>
state). Of course, it needs to be the <em>last</em> action!

<h2>Class event handlers</h2>

<p>The <a href="event-modelling.html#lamp.gif">creation event
handler</a> is implemented as

<pre>
   separate (<i>Domain</i>.Lamp)
   procedure Creation
     (Ev : Creation Event) is
   begin
      ...
   end Creation;
</pre>


<hr>
<i>
<address>
<a href="mailto:simon@pushface.org">Simon Wright</a>
</address>
<script>
document.write("Last update: ");
document.write(document.lastModified);
</script>
</i></body>
</html>