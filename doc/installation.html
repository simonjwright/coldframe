<!-- $Id: installation.html,v 127c231499eb 2011/11/13 19:24:08 simonjwright $ -->
<html>
<head>
<title>ColdFrame: Installation</title>
<link href="cf.css" rel="stylesheet" type="text/css"/>
</head>
<body>

<div id="header">
<a
href="http://sourceforge.net"><img
src="http://sourceforge.net/sflogo.php?group_id=135558&amp;type=1"
width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
</div>

<h1>ColdFrame: Installation</h1>

<hr>

<h2>Windows notes</h2>

<p>ColdFrame is built on a Unix system and requires typical Unix
utilities in order to function.

<p>A Unix-like environment which has proved effective in the past
is <a href="http://www.cygwin.com/">Cygwin</a>.

<p>Unfortunately, at the time of writing (13.xi.11) there are severe
problems with this environment, in that Cygwin doesn't provide
packages for TclXML or TclLib, and neither does the
previously-recommended alternative free Tcl/Tk implementation
from <a href="http://www.activestate.com/">Active State</a>.

<hr>

<h2>Prerequisites</h2>

<p>ColdFrame uses:

<ul>

<li><a href="http://www.sourceforge.net/projects/tcl/">Tcl/Tk</a> with
<ul>
<li><a href="http://www.sourceforge.net/projects/incrtcl/">iTcl also
known as [incr Tcl]</a> (an OO extension)
<li><a href="http://sourceforge.net/projects/tclxml/">TclXml</a>
</ul>

<li><a href="http://www.python.org">Python</a> with
<ul>
<li><a href="http://www.dabeaz.com/ply">PLY</a> (Lex and Yacc in Python)
</ul>

<li><a href="http://sourceforge.net/projects/saxon/">Saxon</a> (an
XSLT processor)

<li><a href="http://www.adacore.com">GNAT</a> (an Ada 95/2005/2012
compiler)

<li>The <a href="http://booch95.sourceforge.net/index.html">Booch
Components</a> (an Ada 95 container library)

</ul>

<h2>Environment variables</h2>

<p>These are the main environment variables that can be used to
control ColdFrame's code generation. The indicated defaults are as set
up in the Makefile <tt>Makefile.inc</tt>. They can all be overridden
except for <tt>ADA_PROJECT_PATH</tt> (which <tt>Makefile.inc</tt>
extends).

<table border="1">

<tr>
<th>Variable
<th>Meaning
<th>Default

<tr><td>ADA_PROJECT_PATH
<td>Where
your <a href="http://gcc.gnu.org/onlinedocs/gnat_ugn_unw/GNAT-Project-Manager.html">GNAT
Project</a> <tt>.gpr</tt> files are. Makefile.inc adds its own
location to your setting.
<td>-

<tr><td>BLANK_LINES
<td>Should the generated code have extra blank lines to improve legibility?
<td>yes

<tr><td>BUILD_BASE
<td>The directory under which individual object libraries (such
as <tt>coldframe</tt>, <tt>main</tt>) are located.
<td>$COLDFRAME/.build

<tr><td>CASE_EXCEPTIONS
<td>The list of case exceptions to be used when generating code (for
example, "GNAT").
<td>$SCRIPTS/emacs_case_exceptions

<tr><td>CHECKING
<td>The extent of ColdFrame's rule checking.
<td>strict

<tr><td>COLDFRAME
<td>Where ColdFrame is installed (overridden in the Makefiles); set it
to, for example, <tt><i>/where/ever/</i>cf-<i>20110720</i></tt>
<td>-

<tr><td>COLDFRAMEOUT
<td>Where the <tt>.raw</tt> files are to be placed/found.
<td>$COLDFRAME/coldframeout

<tr><td>GENERATE_ACCESSORS
<td>Under what circumstances should accessor code be generated?
<td>defined

<tr><td>GENERATE_DIAGRAMS
<td>Should diagrams be generated as part of generating HTML?
<td>yes

<tr><td>GENERATE_EVENT_LOGGING
<td>Should additional code be generated to log event handing?
<td>no

<tr><td>GENERATE_STUBS
<td>Should stub code be generated instead of the normal code?
<td>no

<tr><td>GNATCHOP
<td>Older ColdFrame projects may have used <tt>Interface</tt> as a
name; it became a keyword in Ada 2005. Modern versions
of <tt>gnatchop</tt> need to be told to adopt Ada95 rules, but older
versions wouldn't understand the flag.
<td>gnatchop -gnat95

<tr><td>JAVA
<td>There should be no need to change this.
<td>java

<tr><td>MAXIMPLDEPTH
<td>It may be that there are subdirectories
of <tt><i>Domain</i>.impl</tt> to be searched for code bodies that
need to be removed from the <tt>.gen</tt> directory.
<td>1

<tr><td>MODELS
<td>Where model files are located (to be overridden with the location
of a project's model files).
<td>$COLDFRAME/models

<tr><td>SAXON
<td>How to run Saxon. Shouldn't need to be overrideden.
<td>$JAVA -cp $SAXON_CLASSPATH com.icl.saxon.StyleSheet

<tr><td>SAXON_CLASSPATH
<td>Where Saxon's code is located.
<td>/usr/local/lib/saxon/saxon.jar

<tr><td>SCRIPTS
<td>Where ColdFrame's scripts are located. Shouldn't need to be overridden.
<td>$COLDFRAME/scripts

<tr><td>STACK_DUMP
<td>Whether <tt>normalize-rose.tcl</tt> is to generate a stack dump on
failure.
<td>yes

<tr><td>UNIT_TEST_SUPPORT
<td>Should unit test support code (enabling inspection etc) be generated?
<td>no

<tr><td>VERBOSE
<td>Should ColdFrame be chatty as it generates code?
<td>no

</table>

<h2>Rose extraction</h2>

<p>The Rose extraction script needs to be told where to place the
extracted files:

<ol>

<li>If the Rose <i>Path Map</i> variable <t>COLDFRAMEOUT</t> is set,
the files are placed in the named directory

<li>Otherwise, if the environment variable <t>COLDFRAMEOUT</t> is set,
the files are placed in the named directory (<font
color="green"><b>strongly recommended</b></font>)

<li>Otherwise, the files are put somewhere, at Rose's whim.

</ol>

<h2>Your Makefile</h2>

<p>To start with, it's best if you make sure that your
Rose <tt>.cat</tt> files are named the same as the corresponding Ada
package: for example, if the Ada package is <tt>Digital_IO</tt> you
should name the Rose package <tt>Digital_IO.cat</tt>.

<p>Create a <tt>Makefile</tt> in the directory where your generated
<tt><i>Domain</i>.gen/</tt> files (will) live (next to your
implementation <tt><i>Domain</i>.impl/</tt> files). Its purpose is to
call up the Makefile that ColdFrame provides.

<p>It should contain at least

<pre>
   include $(COLDFRAME)/Makefile.inc
</pre>

<p>which means you need to type

<pre>
   <i>$</i> make <i>Domain</i>.gen
</pre>

<p>If you want to make life even easier, you can change your Makefile
to

<pre>
   include $(COLDFRAME)/Makefile.inc
   <b>all:: <i>Domain_1</i>.gen</b>
   <b>all:: <i>Domain_2</i>.gen</b>
</pre>

<p>etc, after which you only need to say

<pre>
   <i>$</i> make
</pre>

<p>(until, of course, you find you need to add <tt>Domain_3</tt>).

<p>If you're prepared to issue a slightly more complex command to
build, you can get away without a Makefile at all:

<pre>
   <i>$</i> make -f $COLDFRAME/Makefile.inc <i>Domain</i>.gen
</pre>

<p>(note, no brackets).

<h3><a name="linux-create-build-dirs">Creating your build
directories</a></h3>

<p>Assuming you have the environment variable<tt>COLDFRAME</tt> set
up<, you can say

<pre>
   <i>$</i> $COLDFRAME/scripts/create-build-directories
</pre>

<p>Note, however, that with recent GNATs you can use the <tt>-p</tt>
flag to tell <tt>gnatmake</tt> or <tt>gprbuild</tt> to create any
needed directories as required.

<h3>Creating
a <a href="http://gcc.gnu.org/onlinedocs/gnat_ugn_unw/GNAT-Project-Manager.html">GNAT
Project</a> file</h3>

<p>If you don't need to override any of the <tt>ColdFrame.Project</tt>
source, your project file can be pretty simple: the supplied
<tt>Regressions.gpr</tt> (in the <tt>test/</tt> subdirectory) is

<pre>
   with "Options";
   with "ColdFrame";
   with "bc";
   with "aunit";

   project Regressions is

     for Main use ("<i>regression_tests.adb</i>");

     for Exec_Dir use ".";

     for Source_Dirs use
       (
	"<i>Compilation_Regressions</i>.impl",
	"<i>Compilation_Regressions</i>.gen",
	"<i>Regressions</i>.impl",
	"<i>Regressions</i>.gen"
       );

     for Object_Dir use Options'Object_Dir & "/main";
     package IDE renames Options.IDE;
     package Builder renames Options.Builder;
     package Compiler renames Options.Compiler;
     package Binder renames Options.Binder;
     package Linker renames Options.Linker;

   end Regressions;
</pre>

<p>Add further domains as required, of course.

<h3>Overriding <tt>ColdFrame.Project</tt> source</h3>

<p>If you need to override some of the Ada source code in the
<tt>$COLDFRAME/project</tt> directory, life becomes complicated
because you have to avoid circularity and having multiple occurrences
of the same file; you can't use the supplied
<tt>ColdFrame.gpr</tt>.

<p>Suppose your overriding source is in
<tt>~/Base/Build/ColdFrameProject/project</tt>; change directory to
<tt>~/Base/Build/ColdFrameProject</tt> and say
<pre>
   $ $COLDFRAME/scripts/install-project
</pre>

<p>This will place those of ColdFrame's files that you haven't
overridden in <tt>~/Base/Build/ColdFrameProject/inherited</tt>.

<p>The project file now looks like

<p><pre>
   with "Options";
   with "bc";
   with "aunit";

   project Regressions is

     for Main use ("<i>regression_tests</i>");

     for Exec_Dir use ".";

     Project_Base = external ("HOME") & "/Base/Build/ColdFrameProject";

     for Source_Dirs use
       (
	"<i>Regressions</i>.impl",
	"<i>Regressions</i>.gen",
	external ("COLDFRAME") & "/lib",
	Project_Base & "/project",
	Project_Base & "/inherited"
       );

     for Object_Dir use Options'Object_Dir & "/main";
     package IDE renames Options.IDE;
     package Builder renames Options.Builder;
     package Compiler renames Options.Compiler;
     package Binder renames Options.Binder;
     package Linker renames Options.Linker;

   end Regressions;
</pre>

<hr>

<!--
<h2>Windows notes</h2>

<p>ColdFrame is built on a Unix system and requires typical Unix
utilities in order to function.

<p>A Unix-like environment which has proved effective in the past
is <a href="http://www.cygwin.com/">Cygwin</a>.

<p>Unfortunately, at the time of writing there are severe problems
with this environment, in that Cygwin doesn't provide packages for
TclXML or TclLib, and neither does the previously-recommended
alternative free Tcl/Tk implementation
from <a href="http://www.activestate.com/">Active State</a>.

<p>When installing Cygwin, choose the 'developer' option.
-->

<p><hr>
<i>
<address>
<a href="mailto:simon@pushface.org">Simon Wright</a>
</address>
<script>
document.write("Last update: ");
document.write(document.lastModified);
</script>
</i></body>
</html>
