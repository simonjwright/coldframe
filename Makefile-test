#  Copyright (C) Simon Wright <simon@pushface.org>

#  This package is free software; you can redistribute it and/or
#  modify it under terms of the GNU General Public License as
#  published by the Free Software Foundation; either version 2, or
#  (at your option) any later version. This package is distributed in
#  the hope that it will be useful, but WITHOUT ANY WARRANTY; without
#  even the implied warranty of MERCHANTABILITY or FITNESS FOR A
#  PARTICULAR PURPOSE. See the GNU General Public License for more
#  details. You should have received a copy of the GNU General Public
#  License distributed with this package; see file COPYING.  If not,
#  write to the Free Software Foundation, 59 Temple Place - Suite
#  330, Boston, MA 02111-1307, USA.

# $Id$

# Makefile for tests, use with Cygwin under Windows or Unix (assumes a
# Unix system if Cygwin not detected)

sys = $(shell uname)
ifneq (, $(findstring CYGWIN, $sys))
  system = windows
  exe = .exe
else
  system = unix
  exe =
endif

include ../Makefile-$(system)

all:: executables failures

executables: \
 regression_tests$(exe) \
 event_test-harness$(exe) \
 hierarchies-harness$(exe) \
 stub_test_harness$(exe)

failures: Bad_Model_Regressions.gen Bad_Code_Regressions.gen

.PHONY: force

regression_tests$(exe): Regressions.gen force
	gnatmake -P Regressions

event_test-harness$(exe): Event_Test.gen force
	gnatmake -P Event_Test

hierarchies-harness$(exe): Hierarchies.gen force
	gnatmake -P Hierarchies

stub_test_harness$(exe): Stub_Test.gen Stub_Test_Interface.gen force
	gnatmake -P Stub_Test

Stub_Test_Interface.gen: Stub_Test_Interface.norm
	$(MAKE) $@ GENERATE_STUBS=yes
